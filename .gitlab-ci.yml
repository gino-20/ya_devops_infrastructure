.prepare_env:
  environment:
    name: k8s-sausage
    url: https://gaydukov-08.k8s.praktikum-services.tech/
  before_script:
    - mkdir -p ~/.kube
    - echo -n "${CONFIG}"|base64 -d>~/.kube/config
    - kubectl config get-contexts
    - cd kubernetes

stages:
  - deploy

backend-report:
  stage: deploy
  image: bitnami/kubectl:latest
  extends: .prepare_env
  script:
    - kubectl apply -f backend-report
  only:
    changes:
      - kubernetes/**/*

backend:
  stage: deploy
  image: bitnami/kubectl:latest
  extends: .prepare_env
  script:
    - kubectl apply -f backend
  only:
    changes:
      - kubernetes/**/*

frontend:
  stage: deploy
  image: bitnami/kubectl:latest
  extends: .prepare_env
  script:
    - kubectl apply -f frontend
  only:
    changes:
      - kubernetes/**/*
